<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BizDoc — OCR + OpenAI</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .box { border: 2px dashed #555; padding: 20px; border-radius: 12px; max-width: 520px; }
    input[type=file] { width: 100%; margin: 10px 0; }
    button { background:#000; color:#fff; border:0; padding:10px 18px; border-radius:8px; cursor:pointer; }
    button:hover { background:#222; }
    #status { margin-top:14px; font-weight:bold; }
    a.secondary { display:inline-block; margin-top:12px; }
  </style>
</head>
<body>
  <h1>BizDoc — Upload PDF for OCR + OpenAI → PDF</h1>
  <div class="box">
    <input id="pdfInput" type="file" accept="application/pdf" />
    <button id="analyzeBtn">Analyze & Download</button>
    <div id="status"></div>
    <a class="secondary" href="/ocr-openai-analyze.html">Open dedicated upload page</a>
  </div>

  <script>
    const input = document.getElementById('pdfInput');
    const btn = document.getElementById('analyzeBtn');
    const status = document.getElementById('status');

    btn.onclick = async () => {
      const f = input.files?.[0];
      if (!f) { alert('Please select a PDF file first.'); return; }

      status.textContent = 'Uploading and analyzing... please wait ⏳';

      const fd = new FormData();
      fd.append('file', f, f.name);
      fd.append('language', 'eng');
      fd.append('filename', f.name.replace(/\.pdf$/i,'') + '_BizDoc');

      try {
        const res = await fetch('/api/upload-ocr-openai-download', { method: 'POST', body: fd });
        if (!res.ok) {
          const err = await res.json().catch(()=>({}));
          throw new Error(err.error || ('HTTP ' + res.status));
        }
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = (fd.get('filename') || 'BizDoc_Report') + '.pdf';
        a.click();
        URL.revokeObjectURL(a.href);

        status.textContent = '✅ Analysis complete — PDF downloaded.';
      } catch (e) {
        console.error(e);
        status.textContent = '❌ ' + e.message;
        alert('Error: ' + e.message);
      }
    };
  </script>
</body>
</html>
